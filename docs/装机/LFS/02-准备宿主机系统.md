# **宿主机环境准备**



## **分区**

可以使用fdisk工具对磁盘进行分区，以下是我自己的目录规划，仅做参考

* boot分区: 200M
* /home分区：50G
* /usr分区：30G
* /opt分区：19.8G

通过`mkfs`命令对分区进行初始化

```shell
mkfs.ext4 /dev/sdb1
mkfs.ext4 /dev/xxxx
```



> 由于参考手册中选取的文件系统是ext4，第一次安装为了不出错，选择和手册中一致的文件系统，后续可能会使用xfs再重新装一版



## **设置$LFS变量**

在手册中，将我们做好的分区都挂载到了`/mnt/lfs`目录下，因此需要声明一下lfs变量，主要是为了后续操作方便

```shell
export LFS=/mnt/lfs
```



![image-20220102155346750](https://gitee.com/animezjy/PicGo_img/raw/master/images/202201021553845.png)



## **挂载新分区**



创建目录，并挂载分区

```shell
mkdir -v $LFS/{home,usr,opt,boot}
mount /dev/sdb1 $LFS/boot
mount /dev/sdb2 $LFS/home
mount /dev/sdb3 $LFS/usr
mount /dev/sdb4 $LFS/opt
```



![image-20220102155950963](https://gitee.com/animezjy/PicGo_img/raw/master/images/202201021559050.png)



## **下载软件包**



软件包已经放到我的阿里网盘上，可以自行下载

* [链接地址](https://www.aliyundrive.com/s/M6n9kHgUzu5)



## **最后的准备工作**



使用`root`用户，创建构建LFS需要的目录

```shell
mkdir -pv $LFS/{etc,var} $LFS/usr/{bin,lib,sbin,tools,sources}

for i in bin lib sbin; do
  ln -sv usr/$i $LFS/$i
done

case $(uname -m) in
  x86_64) mkdir -pv $LFS/lib64 ;;
esac
```



看一下现在的目录结构



![image-20220103085819930](https://gitee.com/animezjy/PicGo_img/raw/master/images/202201030858034.png)

## **添加lfs用户**



为了让操作更安全，在编译软件包时，建议使用普通用户，创建`lfs`用户作



```shell
groupadd lfs
useradd -s /bin/bash -g lfs -m -k /dev/null lfs
```

给`lfs`用户授权，让其称为`$LFS`目录的所有者



```shell
chown -v lfs $LFS/{usr{,/*},lib,var,etc,bin,sbin,tools}
case $(uname -m) in
  x86_64) chown -v lfs $LFS/lib64 ;;
esac
```





## **配置环境**



 使用`lfs`用户操作



```shell
cat > ~/.bash_profile << "EOF"
exec env -i HOME=$HOME TERM=$TERM PS1='\u:\w\$ ' /bin/bash
EOF
```

> 此时切换到lfs用户时, 终端会出现-bash-4.2$, 不必担心，等环境配置完这个问题就会解决

我们都知道，在linux中，切换到一个普通用户之后，首先它会读取`/etc/profile`文件（这个文件包含了一些设置和环境变量），然后读取家目录下的`.bash_profile`文件. 上面这条代码在`.bash_profile`文件中新建了一个shell环境用来替代系统中的shell。

也就是说，我们需要创建一个独立于系统shell之外的干净的环境



配置`.bashrc`文件

```shell
cat > ~/.bashrc << "EOF"
set +h
umask 022
LFS=/mnt/lfs
LC_ALL=POSIX
LFS_TGT=$(uname -m)-lfs-linux-gnu
PATH=/usr/bin
if [ ! -L /bin ]; then PATH=/bin:$PATH; fi
PATH=$LFS/tools/bin:$PATH
CONFIG_SITE=$LFS/usr/share/config.site
export LFS LC_ALL LFS_TGT PATH CONFIG_SITE
EOF
```



检查配置



```shell
source ~/.bash_profile
```

![image-20220102190324985](https://gitee.com/animezjy/PicGo_img/raw/master/images/202201021903081.png)



至此，宿主机环境准备的差不多了，下一节中会介绍交叉工具链和临时工具的构建